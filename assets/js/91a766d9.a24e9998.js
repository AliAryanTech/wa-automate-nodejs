"use strict";(self.webpackChunkdocs_v_3=self.webpackChunkdocs_v_3||[]).push([[6451],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>d});var s=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,s)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,s,r=function(e,n){if(null==e)return{};var t,s,r={},o=Object.keys(e);for(s=0;s<o.length;s++)t=o[s],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)t=o[s],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=s.createContext({}),c=function(e){var n=s.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=c(e.components);return s.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return s.createElement(s.Fragment,{},n)}},m=s.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=a(e,["components","mdxType","originalType","parentName"]),m=c(t),d=r,f=m["".concat(l,".").concat(d)]||m[d]||p[d]||o;return t?s.createElement(f,i(i({ref:n},u),{},{components:t})):s.createElement(f,i({ref:n},u))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=m;var a={};for(var l in n)hasOwnProperty.call(n,l)&&(a[l]=n[l]);a.originalType=e,a.mdxType="string"==typeof e?e:r,i[1]=a;for(var c=2;c<o;c++)i[c]=t[c];return s.createElement.apply(null,i)}return s.createElement.apply(null,t)}m.displayName="MDXCreateElement"},2611:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var s=t(7462),r=(t(7294),t(3905));const o={},i="Multiple Sessions",a={unversionedId:"configuration/multiple-sessions",id:"configuration/multiple-sessions",title:"Multiple Sessions",description:"You can run multiple sessions of @open-wa/wa-automate in the same process. This allows you to do interesting things for example:",source:"@site/docs/configuration/multiple-sessions.md",sourceDirName:"configuration",slug:"/configuration/multiple-sessions",permalink:"/docs/configuration/multiple-sessions",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/configuration/multiple-sessions.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Licensed Features",permalink:"/docs/configuration/licensed-features"},next:{title:"Best Practice",permalink:"/docs/advanced/best-practices"}},l={},c=[{value:"Orchestrating multiple sessions",id:"orchestrating-multiple-sessions",level:2}],u={toc:c};function p(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,s.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"multiple-sessions"},"Multiple Sessions"),(0,r.kt)("p",null,"You can run multiple sessions of @open-wa/wa-automate in the same process. This allows you to do interesting things for example:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Design and run automated tests for you WA bot."),(0,r.kt)("li",{parentName:"ol"},"Connect two or more WA numbers to a single (or multiple) message handler(s)"),(0,r.kt)("li",{parentName:"ol"},"Use one client to make sure another one is alive by pinging it.")),(0,r.kt)("p",null,"Please see demo/index.ts for a working example"),(0,r.kt)("p",null,"NOTE: DO NOT CREATE TWO SESSIONS WITH THE SAME SESSIONID. DO NOT ALLOW SPACES AS SESSION ID."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { create, Client, ev} from '@open-wa/wa-automate';\n\nfunction start(client: Client) {\n  ...\n}\n\ncreate({\n  sessionId:'session'\n}).then(client => start(client));\n\ncreate({\n  sessionId:'another_session'\n}).then(client => start(client));\n")),(0,r.kt)("p",null,"You can then capture the QR Code for each session using the following event listener code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"//events are fired with the ev namespace then the session Id. e.g \"qr.another_session\"\n//You can however use the wildcard operator with the new event listener and capture the session Id as a parameter instead.\nev.on('qr.**', async (qrcode,sessionId) => {\n  //base64 encoded qr code image\n  const imageBuffer = Buffer.from(qrcode.replace('data:image/png;base64,',''), 'base64');\n  fs.writeFileSync(`qr_code${sessionId?'_'+sessionId:''}.png`, imageBuffer);\n});\n")),(0,r.kt)("h2",{id:"orchestrating-multiple-sessions"},"Orchestrating multiple sessions"),(0,r.kt)("p",null,"Client sessions are living breathing objects. They CANNOT be stringified and parsed for later use. If you want to 'hold' multiple sessions in one process, make sure to keep them in memory in a session object registry or array."),(0,r.kt)("p",null,"For example, let's say you have a ",(0,r.kt)("inlineCode",{parentName:"p"},"marketing")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"sales")," sessions."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"...\n\nconst clientSessionRegistry = {};\n\nasync start(client){\n  //save for later\n  clientSessionRegistry[client.getSessionId()] = client;\n\n  client.onMessage...\n}\n\n//maybe this is called from an API\nsendText(sessionId, params){\n  //grab the existing client from the 'registry'\n  const client = clientSessionRegistry[sessionId];\n\n  //use the client\n  client.sendText(...params);\n}\n\ncreate().then(client => start);\n")))}p.isMDXComponent=!0}}]);